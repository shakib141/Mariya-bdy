<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Private Chat</title>

<style>
body{
  margin:0;
  height:100vh;
  display:flex;
  flex-direction:column;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#0b0b0b;
  color:#fff;
}

header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:10px;
  background:#111;
}

.left{
  display:flex;
  align-items:center;
}

.left img{
  width:60px;
  height:60px;
  border-radius:50%;
  object-fit:cover;
  margin-right:12px;
  border:2px solid #0a84ff;
}

.right{
  font-size:14px;
  color:#0a84ff;
  cursor:pointer;
}

#chat{
  flex:1;
  padding:10px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
}

.msg{
  max-width:70%;
  padding:10px 14px;
  border-radius:18px;
  margin:6px 0;
  word-wrap:break-word;
  font-size:15px;
}

.me{
  background:#0a84ff;
  align-self:flex-end;
  border-bottom-right-radius:4px;
}

.other{
  background:#2c2c2e;
  align-self:flex-start;
  border-bottom-left-radius:4px;
}

footer{
  display:flex;
  padding:10px;
  background:#111;
}

footer input{
  flex:1;
  padding:10px;
  border-radius:20px;
  border:none;
  outline:none;
}

footer button{
  margin-left:8px;
  padding:10px 16px;
  border:none;
  border-radius:20px;
  background:#0a84ff;
  color:#fff;
  cursor:pointer;
}

#editBox{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}

#editInner{
  background:#1c1c1e;
  padding:20px;
  border-radius:12px;
  width:80%;
}

#editInner input[type="text"]{
  width:100%;
  padding:8px;
  margin:8px 0;
  border-radius:8px;
  border:none;
}

#editInner input[type="file"]{
  color:#fff;
  margin:8px 0;
}
</style>
</head>

<body>

<header>
  <div class="left">
    <img id="profilePic" src="">
    <span id="profileName">Mariya</span>
  </div>
  <div class="right" onclick="openEdit()">Edit profile</div>
</header>

<div id="chat"></div>

<footer>
  <input id="msg" placeholder="Type a messageâ€¦">
  <button onclick="send()">Send</button>
</footer>

<div id="editBox">
  <div id="editInner">
    <input id="nameInput" placeholder="Your name">
    <input type="file" id="picInput" accept="image/*">
    <button onclick="saveProfile()">Save</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const msg = document.getElementById("msg")
const chat = document.getElementById("chat")
const profileName = document.getElementById("profileName")
const profilePic = document.getElementById("profilePic")

let myName = localStorage.getItem("name") || "Me"
let myPic = localStorage.getItem("pic") || ""

profileName.innerText = myName
if(myPic) profilePic.src = myPic

firebase.initializeApp({
  apiKey:"YOUR_API_KEY",
  authDomain:"YOUR_PROJECT.firebaseapp.com",
  databaseURL:"https://YOUR_PROJECT.firebaseio.com",
  projectId:"YOUR_PROJECT"
})

let db = firebase.database().ref("chat")

function send(){
  let text = msg.value.trim()
  if(!text) return

  db.push({
    name: myName,
    text: text,
    pic: myPic,
    time: Date.now()
  })
  msg.value=""
}

db.on("child_added", snap=>{
  let d = snap.val()
  let div = document.createElement("div")
  div.className = "msg " + (d.name===myName ? "me":"other")
  
  let content = ""
  if(d.pic && d.name!==myName){
    content = `<img src="${d.pic}" style="width:30px;height:30px;border-radius:50%;vertical-align:middle;margin-right:6px;"> ${d.text}`
  } else {
    content = d.text
  }
  
  div.innerHTML = content
  chat.appendChild(div)
  chat.scrollTop = chat.scrollHeight
})

function openEdit(){
  document.getElementById("editBox").style.display="flex"
}

function saveProfile(){
  let n = document.getElementById("nameInput").value.trim()
  if(n){
    myName = n
    profileName.innerText = n
    localStorage.setItem("name",n)
  }

  let file = document.getElementById("picInput").files[0]
  if(file){
    let r = new FileReader()
    r.onload = e=>{
      myPic = e.target.result
      profilePic.src = myPic
      localStorage.setItem("pic",myPic)
    }
    r.readAsDataURL(file)
  }
  document.getElementById("editBox").style.display="none"
}
</script>

</body>
</html>
